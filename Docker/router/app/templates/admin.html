<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Gestión de usuarios · Portal cautivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/static/base.css" rel="stylesheet" />
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-inner">
        <h1>
          <span class="logo">CP</span>
          Gestión de usuarios
        </h1>
        <div class="subtitle">
          Crea o elimina cuentas que pueden autenticarse en el portal cautivo.
        </div>

        <div class="helper">
          Estás autenticado como <strong>{{ admin_user }}</strong>.
          Las credenciales se validan con HTTP Basic (usuario/contraseña).
        </div>

        <div class="users">
          <div class="users-header">
            <div>Usuario</div>
            <div>Rol</div>
            <div class="user-actions">Acciones</div>
          </div>
          {% for u in users %}
          <div class="user-row">
            <div>{{ u["u"] }}</div>
            <div>
              {% if u["u"] == "admin" %}
                <span class="badge admin">admin</span>
              {% else %}
                <span class="badge">usuario</span>
              {% endif %}
            </div>
            <div class="user-actions">
              {% if u["u"] != "admin" %}
              <form method="post" action="/admin/users/delete">
                <input type="hidden" name="username" value="{{ u['u'] }}" />
                <button type="submit">Eliminar</button>
              </form>
              {% else %}
                <span style="font-size:0.7rem;color:var(--muted);">bloqueado</span>
              {% endif %}
            </div>
          </div>
          {% endfor %}
          {% if not users %}
          <div style="padding:6px 0;font-size:0.78rem;color:var(--muted);">
            No hay usuarios definidos.
          </div>
          {% endif %}
        </div>

        <div class="create-box">
          <h2>Nueva cuenta</h2>
          <form method="post" action="/admin/users/create">
            <div>
              <label for="new_username">Usuario</label>
              <input id="new_username" name="username"
                     placeholder="p.ej. estudiante1" required />
            </div>
            <div>
              <label for="new_password">Contraseña</label>
              <input id="new_password" name="password" placeholder="••••••••" required />
            </div>
            <div>
              <button type="submit">Crear</button>
            </div>
          </form>
        </div>

        {% if message %}
        <div class="helper" style="margin-top:10px;">
          {{ message }}
        </div>
        {% endif %}

        <div class="meta">
          <span><a href="/login">Volver al portal</a></span>
          <span>Tiempo de sesión: {{ auth_timeout }} s</span>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
